---
description: Собственная документация для обмена сообщениями
title: Встроенные сообщения
author: MSEdgeTeam
ms.author: msedgedevrel
ms.date: 10/06/2020
ms.topic: article
ms.prod: microsoft-edge
keywords: Edge-Chromium, Разработка расширений, расширения браузера, надстройки, центр партнера, разработчик
ms.openlocfilehash: c5da9acf79225c88ad5829c2b7f57d1d833ca49b
ms.sourcegitcommit: 75c200a029d19fe372c1505c0006dbfbfad90bf5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2020
ms.locfileid: "11100254"
---
# Встроенные сообщения  

Расширения взаимодействуют с собственными приложениями Win32, установленными на устройстве пользователя с помощью API передачи сообщений.  Хост приложений для машинного кода отправляет и получает сообщения с расширениями с помощью стандартных входных и стандартных выходных данных.  Расширения с использованием встроенных сообщений устанавливаются в Microsoft EDGE, аналогично любому другому добавочному номеру.  Однако встроенные приложения не устанавливаются и не управляются Microsoft Edge.  

Чтобы получить расширение и собственный хост приложений, у вас есть две модели распространения.  

*   Упакуйте свое расширение и узел вместе.  При установке пакета пользователем устанавливаются и расширение, и узел.
*   Установите расширение с помощью [надстройки Microsoft Edge Store][EdgeAddons], и ваше расширение запросит пользователя установить узел.  

Чтобы создать расширение для отправки и получения сообщений с собственными узлами приложений, выполните указанные ниже действия.  

## Шаг 1: Добавление разрешений для манифеста расширения  

Добавьте `nativeMessaging` разрешение на **manifest.js** файла расширения.  В приведенном ниже фрагменте кода показан пример **manifest.json**.  

```json
    {
          "name": "Native Messaging Example",
          "version": "1.0",
          "manifest_version": 2, 
          "description": "Send a message to a native application.",
          "app": { 
              "launch": { 
                  "local_path": "main.html" } 
                 }, 
          "icons": { 
              "128": "icon-128.png"}, 
          "permissions": ["nativeMessaging"] 
    }
```  

## Шаг 2. Создание собственного файла манифеста узла сообщений  

Собственные приложения должны предоставлять собственный файл манифеста узла сообщений.  Файл манифеста содержит путь к собственной среде выполнения хоста сообщений, метод связи с этим расширением и список допустимых расширений, с которыми он взаимодействует.  Браузер считывает и проверяет собственный манифест узла сообщений.  Браузер не устанавливает и не управляет файлом манифеста собственного узла сообщений.  

```json
    {
        "name": "com.my_company.my_application",
        "description": "My Application",
        "path": "C:\\Program Files\\My Application\\chrome_native_messaging_host.exe",
        "type": "stdio",
        "allowed_origins": [
            "chrome-extension://knldjmfmopnpolahpmmgbagdohdnhkik/"
        ]
    }
```  

Файл манифеста узла должен представлять собой допустимый JSON-файл, содержащий указанные ниже ключи.  

:::row:::
   :::column span="1":::
      `name`  
   :::column-end:::
   :::column span="2":::
      Указывает имя собственного узла сообщений.  Клиенты передают эту строку `runtime.connectNative` или `runtime.sendNativeMessage` .  
      
      *   Это значение должно содержать только строчные буквы, цифры, знаки подчеркивания и точки.  
      *   Это значение не должно начинаться или заканчиваться точкой, а точка после нее не должна быть другой точкой.  
   :::column-end:::
:::row-end:::  
:::row:::
   :::column span="1":::
      `description`  
   :::column-end:::
   :::column span="2":::
      Описание приложения.  
   :::column-end:::
:::row-end:::  
:::row:::
   :::column span="1":::
      `path`  
   :::column-end:::
   :::column span="2":::
      Указывает путь к исходному двоичному узлу сообщений.  
      
      *   На устройствах с Windows вы можете использовать относительные пути к каталогу, содержащему файл манифеста.  
      *   В macOS и Linux путь должен быть абсолютным.  
      
      Ведущий процесс начинается с текущего каталога, для которого указан каталог, содержащий двоичный файл узла.  Например, если для этого параметра задано значение `C:\Application\nm_host.exe` , двоичный файл начинается с текущего каталога \ ( `C:\Application\` \).  
   :::column-end:::
:::row-end:::  
:::row:::
   :::column span="1":::
      `type`  
   :::column-end:::
   :::column span="2":::
      Указывает тип интерфейса, используемого для связи с собственным узлом сообщений.  Это значение указывает Microsoft EDGE на использование `stdin` и `stdout` взаимодействие с узлом.  
      Единственным допустимым значением является значение `stdio` .  
   :::column-end:::
:::row-end:::  
:::row:::
   :::column span="1":::
      `allowed_origins` 
   :::column-end:::
   :::column span="2":::
      Указывает список расширений, которые имеют доступ к собственному узлу сообщений.  Чтобы позволить приложению идентифицировать расширение и взаимодействовать с ним, в файле манифеста собственного узла сообщений задайте следующее значение.  
      
      ```json
      "allowed_origins": ["chrome-extension://{microsoft_catalog_extension_id}"]
      ```  
   :::column-end:::
:::row-end:::  

Неопубликованного расширение для проверки собственного обмена сообщениями с узлом.  
Чтобы неопубликованного расширение во время разработки и извлечения `microsoft_catalog_extension_id` , выполните указанные ниже действия.  

1.  Перейдите к разделу `edge://extensions` , а затем включите выключатель режима разработчика.  
1.  Выберите пункт **загрузить распакованные**, а затем выберите пакет расширения в неопубликованного.  
1.  Нажмите кнопку **ОК**.
1.  Перейдите к `edge://extensions` странице и убедитесь, что в списке указано расширение.  
1.  Скопируйте ключ `microsoft_catalog_extension_id` \ (ID) из списка расширений на странице.

Когда вы будете готовы распространить расширение для пользователей, опубликуйте расширение в магазине надстроек Microsoft Edge.  КОД расширения опубликованного расширения может отличаться от идентификатора, используемого при проведении неопубликованных расширений.  Если идентификатор изменился, обновите `allowed_origins` его в файле манифеста узла, УКАЗАВ идентификатор опубликованного расширения.  

## Шаг 3: копирование собственного файла манифеста узла сообщений в систему  

На заключительном этапе выполняется копирование файла манифеста собственного узла сообщений на компьютер и проверка правильности его настройки.  Чтобы убедиться в том, что файл манифеста размещен в нужном расположении, выполните указанные ниже действия.  Расположение зависит от платформы.  

### [Windows](#tab/windows/)  

<a id="copy-manifest-file"></a>  

Файл манифеста может находиться в любом месте файловой системы.  Установщик приложения должен создать раздел реестра и задать в качестве значения по умолчанию для него полный путь к файлу манифеста.  Ниже приведены примеры разделов реестра.  

```text
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Edge\NativeMessagingHosts\com.my_company.my_application
```

```text
HKEY_CURRENT_USER\SOFTWARE\Microsoft\Edge\NativeMessagingHosts\com.my_company.my_application
```

Чтобы добавить раздел реестра в каталог с ключом манифеста.  

*   Команда "выполнить" в командной строке.    
    
    1.  Выполните следующую команду:  
        
        ```shell
        REG ADD "HKCU\Software\Microsoft\Edge\NativeMessagingHosts\com.my_company.my_application" /ve /t REG_SZ /d "C:\path\to\nmh-manifest.json" /f
        ```  
    
*   Создайте `.reg` файл и запустите его.  
    
    1.  Скопируйте указанную ниже команду в `.reg` файл.  
        
        ```shell
        Windows Registry Editor Version 5.00
        [HKEY_CURRENT_USER\Software\Microsoft\Edge\NativeMessagingHosts\com.my_company.my_application]
        @="C:\\path\\to\\nmh-manifest.json"
        ```  
        
    1.  Запустите `.reg` файл.  
    
Microsoft Edge сначала отправляет 32-разрядный реестр, а затем 64-разрядный реестр для идентификации машинных приложений для обмена сообщениями.  Если вы запускаете этот `.reg` файл в пакетном сценарии, убедитесь, что он запущен с помощью командной строки администратора.  

### [macOS](#tab/macos/)  

<a id="copy-manifest-file"></a>  

Чтобы сохранить файл манифеста, выполните одно из указанных ниже действий.  

*   Встроенные системные приложения для обмена сообщениями, доступные всем пользователям, хранятся в определенном месте.  Например, файл манифеста должен храниться в следующем расположении. 
    
    ```bash
    /Library/Microsoft/Edge/NativeMessagingHosts/com.my_company.my_application.json
    ```  
    
*   Пользовательские машинные образы для обмена сообщениями, доступные только для текущего пользователя, находятся в `NativeMessagingHosts` подкаталоге в каталоге профиля пользователя.  Например, файл манифеста должен храниться в следующем расположении.  
    
    ```bash
    ~/Library/Application Support/Microsoft Edge {Channel_Name}/NativeMessagingHosts/com.my_company.my_application.json
    ```  
    
    Значение  `{Channel_Name}` in `Microsoft Edge {Channel_Name}` должно быть одним из указанных ниже значений.  
    
    *   Canary  
    *   Dev  
    *   Beta  

    При использовании стабильного канала `{Channel_Name}` не требуется.  

### [Linux](#tab/linux/)  

<a id="copy-manifest-file"></a>  

Чтобы сохранить файл манифеста, выполните одно из указанных ниже действий.  

*   Встроенные системные приложения для обмена сообщениями, доступные всем пользователям, хранятся в определенном месте.  Файл манифеста должен храниться в следующем расположении.  
    
    ```bash
    /etc/opt/edge/native-messaging-hosts
    ```
    
*   Пользовательские машинные образы для обмена сообщениями, доступные только для текущего пользователя, находятся в `NativeMessagingHosts` подкаталоге в каталоге профиля пользователя.  Файл манифеста должен храниться в следующем расположении.  
    
    ```bash
    ~/.config/microsoft-edge/NativeMessagingHosts
    ```  
    
* * *  

> [!NOTE]
> Убедитесь, что у вас есть разрешения на чтение для файла манифеста, и выполните разрешения для исполняющей среды узла.  

<!-- links -->  

> [!NOTE]
> Части этой страницы представляют собой изменения, основанные на работе, созданной и [предоставленной компанией Google][GoogleSitePolicies] и использованными в соответствии с условиями, описанными в [лицензии Creative Commons 4,0 международная лицензия][CCA4IL].  
> [Здесь](https://developer.chrome.com/extensions/nativeMessaging)будет найдена исходная страница.  

[![Лицензия Creative Commons][CCby4Image]][CCA4IL]  
Эта работа предоставляется в рамках международной лицензии [Creative Commons Attribution 4.0 International License][CCA4IL].  

[EdgeAddons]: https://microsoftedge.microsoft.com/addons/Microsoft-Edge-Extensions-Home "Надстройки Microsoft Edge"
[CCA4IL]: https://creativecommons.org/licenses/by/4.0  
[CCby4Image]: https://i.creativecommons.org/l/by/4.0/88x31.png  
[GoogleSitePolicies]: https://developers.google.com/terms/site-policies
