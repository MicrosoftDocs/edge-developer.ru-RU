---
description: Собственная документация для обмена сообщениями
title: Встроенные сообщения
author: MSEdgeTeam
ms.author: msedgedevrel
ms.date: 09/28/2020
ms.topic: article
ms.prod: microsoft-edge
keywords: Edge-Chromium, Разработка расширений, расширения браузера, надстройки, центр партнера, разработчик
ms.openlocfilehash: 9d33fc4e8c9449d539b6ea82cca87c3aad4d564e
ms.sourcegitcommit: 39636248d0266730089aa2e57b9cf04d9feb363d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "11088557"
---
# Встроенные сообщения  

Расширения могут взаимодействовать с собственными приложениями Win32, установленными на устройстве пользователя с помощью API передачи сообщений. Собственный хост приложений может отправлять и получать сообщения с расширениями с помощью стандартных входных и стандартных выходных данных. Расширения с использованием встроенных сообщений устанавливаются в Microsoft EDGE, аналогично любому другому добавочному номеру. Однако встроенные приложения не устанавливаются и не управляются Microsoft Edge.

Чтобы получить расширение и собственный хост приложений, вы можете:

1. Упакуйте расширение вместе с узлом. При установке пакета пользователи устанавливаются и расширение, и узел.
1. Установите расширение из магазина для [надстроек Microsoft Edge][EdgeAddons]и запросите у пользователей свое расширение, чтобы установить узел. 

Ознакомьтесь с приведенными ниже инструкциями, чтобы настроить расширение для отправки и получения сообщений с собственными хостами приложений.

### Действие 1: Добавление разрешений в манифест расширения

Добавьте разрешение nativeMessaging к **manifest.jsу** расширения для файла. Ниже приведен пример manifest.js:

```json
    {
          "name": "Native Messaging Example",
          "version": "1.0",
          "manifest_version": 2, 
          "description": "Send a message to a native application.",
          "app": { 
              "launch": { 
                  "local_path": "main.html" } 
                 }, 
          "icons": { 
              "128": "icon-128.png"}, 
          "permissions": ["nativeMessaging"] 
    }
```

### Действие 2: создание собственного файла манифеста узла сообщений
    
Собственные приложения должны предоставлять собственный файл манифеста узла сообщений. Этот файл манифеста содержит путь к исполняемому объекту хоста сообщений, методу связи с расширением и списку допустимых расширений, с которыми он может взаимодействовать. Браузеры читают и проверяют собственный манифест узла сообщений, но не устанавливаются и не управляются браузером. Файл манифеста узла должен представлять собой допустимый JSON-файл, содержащий указанные ниже поля.

    
```json
    {
        "name": "com.my_company.my_application",
        "description": "My Application",
        "path": "C:\\Program Files\\My Application\\chrome_native_messaging_host.exe",
        "type": "stdio",
        "allowed_origins": [
            "chrome-extension://knldjmfmopnpolahpmmgbagdohdnhkik/"
        ]
    }
```  




| Имя | Описание |  
|:--- |:--- |  
| `name` | Имя собственного узла сообщений. Клиенты передают эту строку `runtime.connectNative` или `runtime.sendNativeMessage` .  Это имя должно содержать только строчные буквы, цифры, знаки подчеркивания и точки.  Имя не должно начинаться или заканчиваться точкой, а точка после нее не должна быть другой точкой. |  
| `description` | Краткое описание приложения. |  
| `path` | Путь к двоичному файлу хоста сообщений в машинном коде. На устройствах с Windows вы можете использовать относительные пути к каталогу, содержащему файл манифеста. В macOS и Linux путь должен быть абсолютным. Процесс хоста запустится с текущим набором каталогов и каталогом, содержащим двоичный файл узла. Например, если для этого параметра задано значение `C:\Application\nm_host.exe` , двоичный код запускается с текущим каталогом `C:\Application\` . |  
| `type` | Тип интерфейса, используемого для связи с собственным узлом сообщений.  В настоящее время для этого параметра существует только одно возможное значение: `stdio` .  Это значение указывает на то, что Microsoft Edge должен использовать `stdin` и `stdout` взаимодействовать с узлом. |  
| `allowed_origins` |  Список расширений, которые могут иметь доступ к собственному узлу сообщений.  Чтобы позволить приложению идентифицировать расширение и взаимодействовать с ним, установите `allowed_origins` для него значение `chrome-extension://[Microsoft-Catalog-extensionID]` в исходном файле манифеста узла сообщений. |  


В процессе разработки вы можете неопубликованного расширение для проверки собственного обмена сообщениями с узлом, выполнив следующие действия:
1. Перейдите к `edge://extensions` элементу, а затем включите выключатель режима разработчика. 
1. Выберите пункт Загрузить распакованные, а затем выберите пакет расширения в неопубликованного.  
1. Нажмите кнопку ОК.
1. Убедитесь, что `edge://extensions` теперь на странице указано расширение. 
1. Скопируйте ключ из идентификатора из списка расширений на странице.

Когда вы будете готовы распространить расширение для пользователей, опубликуйте расширение в магазине надстроек Microsoft Edge. КОД расширения опубликованного расширения может отличаться от идентификатора, используемого при проведении неопубликованного расширения. Если идентификатор изменился, обновите `allowed_origins` его в файле манифеста узла, УКАЗАВ идентификатор опубликованного расширения. 



### Шаг 3: копирование собственного файла манифеста узла сообщений в систему

На заключительном этапе выполняется копирование файла манифеста собственного узла сообщений на компьютер и проверка правильности его настройки. Выполните указанные ниже действия, чтобы убедиться в том, что собственный файл узла сообщений размещен в нужном расположении, так как он зависит от платформы.
    
**Windows**. Файл манифеста может находиться в любом месте файловой системы. Установщик приложения должен создать раздел реестра и задать в качестве значения по умолчанию для него полный путь к файлу манифеста. Ниже приведены примеры разделов реестра.
    
`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Edge\NativeMessagingHosts\com.my_company.my_application`  
    или  
`HKEY_CURRENT_USER\SOFTWARE\Microsoft\Edge\NativeMessagingHosts\com.my_company.my_application`,  
    
Выполните в командной строке следующую команду, чтобы добавить раздел реестра в папку с файлом манифеста.
    
```shell
REG ADD "HKCU\Software\Microsoft\Edge\NativeMessagingHosts\com.my_company.my_application" /ve /t REG_SZ /d "C:\path\to\nmh-manifest.json" /f
```  
    
Кроме того, можно скопировать указанную ниже команду в REG-файл и выполнить его, чтобы добавить раздел реестра. 
    
```shell
Windows Registry Editor Version 5.00
[HKEY_CURRENT_USER\Software\Microsoft\Edge\NativeMessagingHosts\com.my_company.my_application]
@="C:\\path\\to\\nmh-manifest.json"
``` 

  Microsoft Edge сначала отправляет 32-разрядный реестр, а затем 64-разрядный реестр для идентификации машинных приложений для обмена сообщениями. Если вы запустите вышеприведенный reg-файл как часть пакетного сценария, убедитесь, что он запущен с помощью командной строки администратора.


**macOS**. Файл манифеста должен храниться следующим образом:

1. Встроенные системные приложения для обмена сообщениями, доступные всем пользователям, хранятся в определенном месте. Например, файл манифеста должен храниться в `/Library/Microsoft/Edge/NativeMessagingHosts/com.my_company.my_application.json`

1. Пользовательские машинные образы для обмена сообщениями, доступные только для текущего пользователя, находятся в подкаталоге NativeMessagingHosts в каталоге профиля пользователя. Например, файл манифеста должен храниться в  
    `~/Library/Application Support/Microsoft Edge <ChannelName>/NativeMessagingHosts/com.my_company.my_application.json`

    где `ChannelName` может быть Канарские, dev или Beta. При использовании стабильного канала `ChannelName` не требуется.


**Linux** Файл манифеста должен храниться следующим образом:

1. Встроенные системные узлы сообщений на уровне системы:  `~/.config/microsoft-edge/NativeMessagingHosts`

1. Специфические для пользователя машинные узлы сообщений:  `/etc/opt/edge/native-messaging-hosts`


> [!NOTE]
> Убедитесь в том, что у вас есть разрешения на чтение для файла манифеста и выполняются разрешения на исполняемый объект узла.


> [!NOTE]
> Части этой страницы представляют собой изменения, основанные на работе, созданной и [предоставленной компанией Google][GoogleSitePolicies] и использованными в соответствии с условиями, описанными в [лицензии Creative Commons 4,0 международная лицензия][CCA4IL].  
> [Здесь](https://developer.chrome.com/extensions/nativeMessaging)будет найдена исходная страница.  

[![Лицензия Creative Commons][CCby4Image]][CCA4IL]  
Эта работа предоставляется в рамках международной лицензии [Creative Commons Attribution 4.0 International License][CCA4IL].  


<!-- image links -->  

<!-- links -->  

[EdgeAddons]: https://microsoftedge.microsoft.com/addons/Microsoft-Edge-Extensions-Home "Надстройки Microsoft Edge"
[CCA4IL]: https://creativecommons.org/licenses/by/4.0  
[CCby4Image]: https://i.creativecommons.org/l/by/4.0/88x31.png  
[GoogleSitePolicies]: https://developers.google.com/terms/site-policies
