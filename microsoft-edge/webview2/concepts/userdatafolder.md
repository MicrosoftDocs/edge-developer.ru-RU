---
description: Сведения о том, как управлять папками данных пользователей в приложениях WebView2
title: Управление папкой "данные пользователя" в приложениях WebView2.
author: MSEdgeTeam
ms.author: msedgedevrel
ms.date: 09/10/2020
ms.topic: conceptual
ms.prod: microsoft-edge
ms.technology: webview
keywords: IWebView2, IWebView2WebView, webview2, WebView, приложения Win32, Win32, EDGE, ICoreWebView2, ICoreWebView2Host, элемент управления "браузер", HTML EDGE, папка "данные пользователя"
ms.openlocfilehash: 5f341458a85bfab93bd2618b4d274ad6a1edefa2
ms.sourcegitcommit: 0faf538d5033508af4320b9b89c4ed99872f0574
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2020
ms.locfileid: "11010742"
---
# <span data-ttu-id="857e5-104">Управление папкой "данные пользователя"</span><span class="sxs-lookup"><span data-stu-id="857e5-104">Managing the User Data Folder</span></span>  

<span data-ttu-id="857e5-105">Приложения WebView2 взаимодействуют с папками данных пользователей для хранения данных браузера, таких как cookie-файлы, разрешения и кэшированные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="857e5-105">WebView2 applications interact with user data folders to store browser data, such as cookies, permissions, and cached resources.</span></span>  <span data-ttu-id="857e5-106">Каждый экземпляр элемента управления WebView2 связан с папкой данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="857e5-106">Each instance of a WebView2 control is associated with a user data folder.</span></span>  <span data-ttu-id="857e5-107">Каждая папка User Data является уникальной для пользователя.</span><span class="sxs-lookup"><span data-stu-id="857e5-107">Each user data folder is unique to a user.</span></span>  

## <span data-ttu-id="857e5-108">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="857e5-108">Best Practices</span></span>  

<span data-ttu-id="857e5-109">Папки данных пользователя создаются автоматически с помощью WebView2.</span><span class="sxs-lookup"><span data-stu-id="857e5-109">User data folders are created automatically by WebView2.</span></span>  <span data-ttu-id="857e5-110">WebView2 разработчики управляют временем существования папки данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="857e5-110">WebView2 developers control the lifetime of the user data folder.</span></span>  <span data-ttu-id="857e5-111">Если приложение повторно использует пользовательские данные из сеансов приложений, попробуйте сохранить их, в противном случае их можно удалить.</span><span class="sxs-lookup"><span data-stu-id="857e5-111">If your application re-uses user data from application sessions, consider saving the user data folders, otherwise you may delete them.</span></span>  <span data-ttu-id="857e5-112">При принятии решения о том, как управлять папками с данными пользователя, учитывайте указанные ниже сценарии.</span><span class="sxs-lookup"><span data-stu-id="857e5-112">Consider the following scenarios when deciding how to manage your user data folders:</span></span>  

*   <span data-ttu-id="857e5-113">Если один и тот же пользователь несколько раз использует приложение, а веб-содержимое приложения зависит от данных пользователя, сохраните папку с данными о пользователях.</span><span class="sxs-lookup"><span data-stu-id="857e5-113">If the same user uses your application repeatedly, and the web content of the application relies on the user's data, save the user data folder.</span></span>  <span data-ttu-id="857e5-114">Если несколько пользователей многократно используют приложение, создайте новую папку с данными для каждого нового пользователя и сохраните их в папке User Data для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="857e5-114">If multiple users use your application repeatedly, create a new user data folder for each new user, and save the user data folder of each user.</span></span>
*   <span data-ttu-id="857e5-115">Если ваше приложение не имеет повторяющихся пользователей, создайте новую папку данных пользователя для каждого пользователя и удалите предыдущую папку данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="857e5-115">If your application does not have repeat users, create a new user data folder for each user, and delete the previous user data folder.</span></span>  

## <span data-ttu-id="857e5-116">Создание папок с данными пользователя</span><span class="sxs-lookup"><span data-stu-id="857e5-116">Create user data folders</span></span>  

<span data-ttu-id="857e5-117">Чтобы указать расположение папки данных пользователя, включите `userDataFolder` параметр при вызове [ICoreWebView2Environment](../reference/win32/0-9-622/icorewebview2environment.md) \ (Win32 \) или [CoreWebView2Environment](../reference/dotnet/0-9-628/microsoft-web-webview2-core-corewebview2environment.md) \ (.NET \).</span><span class="sxs-lookup"><span data-stu-id="857e5-117">To specify the location of the user data folder, include the `userDataFolder` parameter when calling [ICoreWebView2Environment](../reference/win32/0-9-622/icorewebview2environment.md) \(Win32\) or [CoreWebView2Environment](../reference/dotnet/0-9-628/microsoft-web-webview2-core-corewebview2environment.md) \(.NET\).</span></span>  <span data-ttu-id="857e5-118">После создания данные браузера из элемента управления WebView2 хранятся во вложенной папке `userDataFolder` .</span><span class="sxs-lookup"><span data-stu-id="857e5-118">After creation, browser data from your WebView2 control is stored in a subfolder of `userDataFolder`.</span></span>  <span data-ttu-id="857e5-119">Если `userDataFolder` не указано, WebView2 создает папки данных пользователя в расположениях по умолчанию, как описано ниже.</span><span class="sxs-lookup"><span data-stu-id="857e5-119">When `userDataFolder` is not specified, WebView2 creates user data folders at default locations as follows:</span></span>  

*   <span data-ttu-id="857e5-120">Для приложений, упакованных из Магазина Windows, папка пользователя по умолчанию является `ApplicationData\LocalFolder` вложенной папкой в папке пакета.</span><span class="sxs-lookup"><span data-stu-id="857e5-120">For packaged Windows Store apps, the default user folder is the `ApplicationData\LocalFolder` subfolder in the package's  folder.</span></span>  
*   <span data-ttu-id="857e5-121">Для существующих классических приложений Папка данных пользователя по умолчанию — это путь к исполняемому файлу приложения + `.WebView2` .</span><span class="sxs-lookup"><span data-stu-id="857e5-121">For existing desktop apps, the default user data folder is the exe path of your application + `.WebView2`.</span></span>  <span data-ttu-id="857e5-122">Вместо использования по умолчанию рекомендуется указать папку с данными пользователя и создать ее в той же папке, где хранятся все другие данные приложения.</span><span class="sxs-lookup"><span data-stu-id="857e5-122">Instead of using the default, we recommend that you specify a user data folder, and that you create it in the same folder where all other app data is stored.</span></span>  

## <span data-ttu-id="857e5-123">Удаление папок с данными пользователя</span><span class="sxs-lookup"><span data-stu-id="857e5-123">Delete user data folders</span></span>  

<span data-ttu-id="857e5-124">Приложению может потребоваться удалить папки данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="857e5-124">Your application may need to delete user data folders:</span></span>  

*   <span data-ttu-id="857e5-125">При удалении приложения.</span><span class="sxs-lookup"><span data-stu-id="857e5-125">When uninstalling your app.</span></span>  <span data-ttu-id="857e5-126">Если удалить приложения из магазина для Windows, Windows автоматически удалит папки с данными пользователей.</span><span class="sxs-lookup"><span data-stu-id="857e5-126">If you are uninstalling packaged Windows Store apps, Windows deletes user data folders automatically.</span></span>  
*   <span data-ttu-id="857e5-127">Для очистки всего журнала данных браузера.</span><span class="sxs-lookup"><span data-stu-id="857e5-127">To clean up all browsing data history.</span></span>  
*   <span data-ttu-id="857e5-128">Для восстановления из повреждения данных.</span><span class="sxs-lookup"><span data-stu-id="857e5-128">To recover from data corruption.</span></span>  
*   <span data-ttu-id="857e5-129">Для удаления предыдущих данных сеанса.</span><span class="sxs-lookup"><span data-stu-id="857e5-129">To remove previous session data.</span></span>  

> [!NOTE]
> <span data-ttu-id="857e5-130">Файлы в папках данных пользователя по-прежнему будут использоваться после закрытия приложения WebView2.</span><span class="sxs-lookup"><span data-stu-id="857e5-130">Files in user data folders may still be in use after the WebView2 application is closed.</span></span>  <span data-ttu-id="857e5-131">В этом случае дождитесь завершения процесса браузера и всех дочерних процессов, прежде чем удалять папку.</span><span class="sxs-lookup"><span data-stu-id="857e5-131">In this situation, wait for the browser process and all child processes to exit before deleting the folder.</span></span>  <span data-ttu-id="857e5-132">Идентификатор процесса браузера можно получить с помощью `BrowserProcessId` Свойства WebView2.</span><span class="sxs-lookup"><span data-stu-id="857e5-132">You may retrieve the process id of the browser process using the `BrowserProcessId` property of the WebView2.</span></span>  

## <span data-ttu-id="857e5-133">Общий доступ к папкам данных пользователей</span><span class="sxs-lookup"><span data-stu-id="857e5-133">Share user data folders</span></span>  

<span data-ttu-id="857e5-134">Элементы управления WebView2 могут совместно использовать одни и те же папки данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="857e5-134">WebView2 controls may share the same user data folders to:</span></span>  

*   <span data-ttu-id="857e5-135">[Оптимизируйте системные ресурсы](../concepts/process-model.md) , выполнив один процесс браузера.</span><span class="sxs-lookup"><span data-stu-id="857e5-135">[Optimize system resources](../concepts/process-model.md) by running in one browser process.</span></span>  
*   <span data-ttu-id="857e5-136">Предоставление общего доступа к журналу браузера и кэшированным ресурсам.</span><span class="sxs-lookup"><span data-stu-id="857e5-136">Share browser history and cached resources.</span></span>  

<span data-ttu-id="857e5-137">При совместном доступе к папкам данных пользователей учитывайте следующее:</span><span class="sxs-lookup"><span data-stu-id="857e5-137">Consider the following when sharing user data folders:</span></span>  

1.  <span data-ttu-id="857e5-138">При повторном создании WebView2 элементов управления для обновления версий браузера с помощью событий [add_NewBrowserVersionAvailable](../reference/win32/0-9-622/icorewebview2environment.md#add_newbrowserversionavailable) \ (Win32 \) или [NewBrowserVersionAvailable](../reference/dotnet/0-9-628/microsoft-web-webview2-core-corewebview2environment.md#newbrowserversionavailable) \ (.NET \) убедитесь, что браузеры завершают работу и закрывают элементы управления WebView2, которые имеют доступ к той же папке данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="857e5-138">When re-creating WebView2 controls to update browser versions using [add_NewBrowserVersionAvailable](../reference/win32/0-9-622/icorewebview2environment.md#add_newbrowserversionavailable) \(Win32\) or [NewBrowserVersionAvailable](../reference/dotnet/0-9-628/microsoft-web-webview2-core-corewebview2environment.md#newbrowserversionavailable) \(.NET\) events, ensure browser processes exit and close WebView2 controls that share the same user data folder.</span></span>  <span data-ttu-id="857e5-139">Чтобы получить идентификатор процесса браузера, используйте `BrowserProcessId` свойство элемента управления WebView2.</span><span class="sxs-lookup"><span data-stu-id="857e5-139">To retrieve the process id of the browser process, use the `BrowserProcessId` property of the WebView2 control.</span></span>  

2.  <span data-ttu-id="857e5-140">Для элементов управления WebView2, использующих одну и ту же папку данных пользователя, должны использоваться одинаковые параметры для [ICoreWebView2Environment](../reference/win32/0-9-622/icorewebview2environment.md) \ (Win32 \) или [CoreWebView2Environment](../reference/dotnet/0-9-628/microsoft-web-webview2-core-corewebview2environment.md) \ (.NET).</span><span class="sxs-lookup"><span data-stu-id="857e5-140">WebView2 controls that share the same user data folder must use the same options for [ICoreWebView2Environment](../reference/win32/0-9-622/icorewebview2environment.md) \(Win32\) or [CoreWebView2Environment](../reference/dotnet/0-9-628/microsoft-web-webview2-core-corewebview2environment.md) \(.NET\).</span></span>  <span data-ttu-id="857e5-141">В противном случае создание WebView2 завершается сбоем `HRESULT_FROM_WIN32(ERROR_INVALID_STATE)` .</span><span class="sxs-lookup"><span data-stu-id="857e5-141">If not, the WebView2 creation will fail with `HRESULT_FROM_WIN32(ERROR_INVALID_STATE)`.</span></span>  

<span data-ttu-id="857e5-142">Чтобы изолировать различные части приложения или совместное использование данных между элементами управления WebView2, вы можете выбрать использование разных папок данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="857e5-142">To isolate different parts of your application or when sharing data between WebView2 controls is not needed, you may choose to use different user data folders.</span></span>  <span data-ttu-id="857e5-143">Например, приложение может состоять из двух элементов управления WebView2, для отображения объявления и другого для отображения содержимого приложения.</span><span class="sxs-lookup"><span data-stu-id="857e5-143">For example, an application may consist of two WebView2 controls, one for displaying an advertisement and the other for displaying application content.</span></span>  <span data-ttu-id="857e5-144">В этом сценарии разработчики могут использовать различные папки данных пользователя для каждого элемента управления WebView2.</span><span class="sxs-lookup"><span data-stu-id="857e5-144">In this scenario, developers may opt to use different user data folders for each WebView2 control.</span></span>  

> [!NOTE]
> <span data-ttu-id="857e5-145">Каждый процесс браузера WebView2 потребляет дополнительную память и место на диске.</span><span class="sxs-lookup"><span data-stu-id="857e5-145">Each WebView2 browser process consumes additional memory and disk space.</span></span>  <span data-ttu-id="857e5-146">Поэтому мы не рекомендуем запускать WebView2s с использованием слишком большого числа разных папок данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="857e5-146">Therefore, we recommend not running WebView2s with too many different user data folders at the same time.</span></span>  
