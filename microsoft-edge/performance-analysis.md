---
ms.assetid: 7a5f9fd0-90a9-43db-b271-178c06da5896
description: С помощью средств разработчика F12 вы можете анализировать общую производительность веб-сайтов.
title: Анализ производительности
author: MSEdgeTeam
ms.author: msedgedevrel
ms.date: 02/08/2017
ms.topic: article
ms.prod: microsoft-edge
keywords: EDGE, веб-разработка, HTML, CSS, JavaScript, разработчик
ms.openlocfilehash: 7bf71744298502c9edf8ee1262fceff5640bedf1
ms.sourcegitcommit: 6860234c25a8be863b7f29a54838e78e120dbb62
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2020
ms.locfileid: "10572816"
---
# Анализ производительности

Если вы не знакомы с производительностью, вы должны ознакомиться с [руководством по DevTools F12](./devtools-guide.md).
[Средства F12](./devtools-guide.md) , встроенные в Microsoft EDGE, можно использовать для анализа общего функционирования веб-сайта. Она предоставляет аналогичные (но более ограниченные) возможности для [набора средств для оценки производительности Windows](https://docs.microsoft.com/windows-hardware/test/wpt/index) прямо в браузере.



Если вам нужен более глубокий анализ производительности браузера, группа Microsoft Edge использует [набор средств для оценки производительности Windows](https://docs.microsoft.com/windows-hardware/test/wpt/index) (WPT). WPT была создана командой Windows для анализа производительности программы в более глубоком виде. Он задействует границы между веб-сайтом JavaScript и Microsoft Edge Native Code, позволяя просматривать их в одном и том же инструменте. WPT можно использовать для того, чтобы:
 - Измерение времени ЦП, затраченного на полную работу программного обеспечения
 - Расчет памяти, выделенной программным обеспечением
 - Отображение сведений о загрузке файлов с удаленных серверов
 - Измеряет частоту кадров.


Чтобы приступить к анализу веб-сайта с помощью средства Windows Performance Toolkit, сначала необходимо загрузить [комплект средств для оценки и развертывания Windows 10 (ADK)](https://developer.microsoft.com/windows/hardware/windows-assessment-deployment-kit). В процессе установки выберите параметр *Windows Performance Toolkit* .

![Варианты установки для ADK](./media/adk-installoptions.png)

Здесь мы покажем, как записать и проанализировать трассировку производительности. Дополнительные сведения о том, что входит в состав набора средств для оценки производительности Windows, можно найти в полной [документации WPT](https://docs.microsoft.com/windows-hardware/test/wpt/index).

## Запись трассировки
Затем настройте пользовательский сценарий и подготовьтесь к сбору трассировки с помощью средства записи производительности Windows.
Ниже описано, как профилировать веб-сценарий с помощью *средства записи производительности Windows (ЗВЧ)*.

### 1. Подготовка среды для сбора данных о трассировке производительности
Чтобы избежать шума в трассировке, которую вы собираетесь записать, завершите работу максимально возможного количества запущенных программ. В идеале единственным запущенным программным обеспечением будет средство записи производительности Windows (ЗВЧ) и браузер.

### 2. Запуск средства записи производительности Windows (ЗВЧ) и выбор параметров
Запустите средство записи производительности Windows и убедитесь, что переключатель **дополнительных параметров** расширен. Установите флажки " *Обозреватель Edge* " и "анализ сценария *отклика HTML* ".

![Параметры записи производительности Windows](./media/wprui-options.png)

#### Советы и рекомендации по сбору трассировок
- Попробуйте сохранить фоновую активность абсолютной требуемой минимальной величины. Фоновые процессы могут наклонять как распознанную производительность, так и реальные характеристики производительности и влиять на результаты. В идеале не работают другие приложения, работающие в браузере и ЗВЧ.
- Определите сценарии, которые вы анализируете, и постарайтесь сделать их как можно более атомарными. Например, если на сайте возникли проблемы с производительностью при загрузке страницы, прокрутку и выборе чего-либо в таблице, разделите проблемы на три сценария.
  - Загрузка страницы (от начала навигации до загрузки страницы завершена)
  - Scroll
  - Выбор чего-либо в таблице
- Если сценарий включает переход на веб-сайт, рассматривайте сценарий в разделе about: blank. Начиная с about: blank, вы не сможете накладные расходы на предыдущей странице. Если это связано с сайтом, перейдите к разделу about: blank, чтобы завершить сценарий. Это позволит предотвратить Отслежение от других сайтов, пока не будет определена проблема, связанная с обработкой.

### 3. запись сценария
Нажмите кнопку **начать** , чтобы начать запись. Инструмент сообщит о размере буфера, который он использует, чтобы помочь вам оценить размер создаваемого файла. Выполните сценарий пользователя, который вы хотите измерить, и нажмите кнопку **сохранить** , чтобы остановить запись и сохранить трассировку. Сохранение сразу после завершения сценария поможет минимизировать размер файла трассировки.

![Начало записи производительности Windows](./media/wprui-recording.png)

Инструмент "ЗВЧ" укажет, что данные трассировки были успешно сохранены:

![Начало записи производительности Windows](./media/wprui-savecomplete.png)


## Анализ трассировки
Теперь, когда вы собрали данные о производительности, вы можете проанализировать трассировку с помощью анализатора производительности Windows, чтобы узнать, какие оптимизации можно выполнить.
Ниже показано, как проанализировать данные о производительности веб-сценария.

### 1. Запустите анализатор производительности Windows (WPA).
Запустите анализатор быстродействия Windows и откройте `.etl` файл, который нужно проанализировать (открыть**файл**  >  **...**).

### 2. Загрузите символы и примените профиль для *анализа HTML* .

>[!WARNING]
> Для первой загрузки символов потребуется большое количество загрузок и это займет много времени на обычном подключении к Интернету.

Загрузите символы, выбрав в меню пункт " **Трассировка**  >  **символов загрузки** ". Символы будут помещены в кэш диска, и последующие трассировки загружают символы гораздо быстрее.

Вы можете значительно быстрее загрузить символы, ограничивая загрузку в Microsoft EDGE и на узел веб-приложений. Выберите команду **Трассировка**:  >  **Настройка символов** и запретите только **Параметры загрузки** `MicrosoftEdgeCP.exe` `WWAHost.exe` .

![Ограничения на символы](./media/wpa-symbolrestrictions.png)

После того как символы начнут загружаются, примените *профиль анализа HTML* (**Профили**  >  **применяются...**  >  ). **Просмотреть каталог...**  >  **HtmlResponsivenessAnalysis. wpaProfile**) профиль будет загружать несколько графиков и таблиц для анализа. Для расследования практических веб-сайтов рекомендуется начать с этого профиля.

![Крупный рисунок](./media/wpa-bigpicture.png)


#### Профиль анализа отклика HTML
В профиле анализа *отклика на HTML* есть четыре вкладки:

**Крупный рисунок** — это полезно для подтверждения того, что у вас нет неожиданных источников активности ЦП, и браузер действительно использует все доступные ресурсы. Проверьте использование ЦП и убедитесь, что ни одна из процессов не сильно загружает использование ЦП, кроме браузера.

**Анализ кадров** — этот раздел используется для базового анализа. Граф *использования ЦП (с атрибутами)* позволяет быстро ознакомиться с подсистемами, ответственными за использование ЦП. Разбиение образцов в таблице " *использование ЦП" (пример)* в *потоке пользовательского интерфейса HTML* поможет вам выявить критические проблемы с производительностью.

**Маркеры трассировки** — этот раздел содержит все маркеры трассировки, поступающие из браузера (Microsoft EDGE), в том числе *msWriteProfilerMark*, который предоставляет точные моменты для измерения кода. Чтобы просмотреть трассировку *msWriteProfilerMark* , прокрутите страницу вниз до графа *универсальных событий* и выберите **HTML-msWriteProfilerMark** из раскрывающегося меню.

**Анализ задержки потока** : Эта вкладка часто используется разработчиками Microsoft Edge для изучения того, что один поток заблокирован и ожидает другого. В редких случаях это может быть полезно и для веб-разработчиков.


### 3. изменение масштаба для удаления очистки трассировки
Вы можете сосредоточиться на вашем анализе за счет удаления пустых конечных разделов *очистки трассировки* на диаграммах. На любом из показанных на данный момент диаграмм:
 - Щелчок левой кнопкой мыши в начале данных диаграммы, которую вы хотите исследовать
 - Удержание, перетаскивание и выпуски для выделения нужной области
 - Щелкните правой кнопкой мыши и выберите команду " **масштаб** "

Масштабирование будет применено ко всем графикам и диаграммам на активной вкладке.

![Опубликовать масштаб](./media/wpa-postzoom.png)


### 4. Изучите, что займет циклы ЦП.
 В таблице " **использование ЦП" (пример)** на вкладке " **Анализ кадров** ", скорее всего, будет возникать большая часть анализа. Вы можете разворачивать различные процессы, чтобы определить наиболее ресурсоемкие сценарии JavaScript и кода браузера. Часто для устранения проблем с производительностью отвечает один и тот же набор JavaScript, а время его оптимизации может значительно отличаться.

### 5. прокрутка любого медленно работающего кода JavaScript
Поэтапный анализ вызовов DOM может быть полезен для определения JavaScript, ответственен за выполнение большинства событий в сценарии. Это особенно полезно, когда многие вызовы верхнего уровня повторно используют одни и те же библиотеки JavaScript.

Начните с изучения *использования ЦП (Выборочная) с разбивкой по процессам, потокам, действиям, стопу*. Щелкните любую ячейку в столбце " **стопка** ". Нажмите клавиши *CTRL + F* и выполните поиск по запросу *ExternalFunctionThunk*.

>[!NOTE] 
>Это работает только в том случае, если вы успешно загрузили символы.

![Поиск ExternalFunctionThunk](./media/wpa-externalfunctionthunk.png)

Изучите все строки с помощью *ExternalFunctionThunk*. Это интерфейс из обработчика JavaScript Chakra в обработчик Microsoft Edge. В нем показано, где переводятся мосты кода из браузера в выполнение JavaScript. Щелкните строку правой кнопкой мыши и выберите команду **Просмотреть Callees**  >  **по модулю,** чтобы увидеть взвешенный список со всеми наиболее продолжительными функциями обработчиков браузера.

![Просмотреть Callees](./media/wpa-viewcallees.png)

Чтобы определить весь JavaScript, вызывающий определенный API-интерфейс, щелкните его правой кнопкой мыши и выберите команду **Просмотреть вызывающие объекты**  >  **по функциям** , а затем разверните дерево для просмотра и сравнения относительных весов.
