---
title: Управление сетевыми запросами и Push-уведомлениями с помощью рабочих процессов служб
description: Служебные работники — это веб-роли, которые помогают улучшить производительность, реагировать на различные условия сети и улучшать связь с веб-приложением.
author: MSEdgeTeam
ms.author: msedgedevrel
ms.date: 05/15/2020
ms.topic: conceptual
ms.prod: microsoft-edge
ms.technology: pwa
keywords: прогрессивные веб-приложения, PWA, EDGE, JavaScript, Windows, UWP, Microsoft Store
ms.openlocfilehash: 9bf573b668ade351716b69965f653e05857c32ec
ms.sourcegitcommit: d9cc829deb709b0866f6b43a5f4733682ddae5ca
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2020
ms.locfileid: "10659302"
---
# Управление сетевыми запросами и Push-уведомлениями с помощью рабочих процессов служб

Служебные работники — это особый тип рабочего процесса, с помощью которого можно перехватывать, изменять и отвечать на все сетевые запросы, используя `Fetch` API-интерфейс.  Работники служб могут получить доступ к `Cache` API и асинхронные хранилища данных на стороне клиента, например `IndexedDB` , для хранения ресурсов.  

## Регистрация сотрудника службы  

Как и другие веб-работники, сотрудники служб должны находиться в отдельном файле. Вы хотите сослаться на этот файл при регистрации сотрудника службы, как показано в следующем фрагменте кода.  

```javascript
if ( "serviceWorker" in navigator ) {
    navigator.serviceWorker.register( "/serviceworker.min.js" );
}
```  

Современные браузеры предоставляют разные уровни поддержки для сотрудников служб. Таким образом, `serviceWorker` перед выполнением любого кода, связанного с сервисными сотрудниками, рекомендуется проверить существование объекта. В приведенном выше фрагменте кода сотрудник службы зарегистрирован с помощью `serviceworker.min.js` файла, расположенного в корне сайта. Убедитесь, что файл JavaScript, который определяет сотрудника службы, существует в каталоге верхнего уровня, который вы хотите использовать для управления \ (который называется областью действия сотрудника).  В приведенном выше фрагменте кода файл хранится в корневом каталоге, а рабочий процесс управляет всеми страницами в домене. Если рабочий файл службы хранился в `js` каталоге, областью обслуживания является `js` каталог и вложенные папки.  Рекомендуется размещать файл рабочего процесса службы в корне сайта, если вам не нужно уменьшать область обслуживания.  

## Жизненный цикл обслуживания сотрудников  

Жизненный цикл сотрудника службы состоит из нескольких шагов, каждый из которых инициирует событие. Вы можете добавлять прослушиватели для этих событий, чтобы выполнить код для выполнения действия. В приведенном ниже списке представлено общее представление жизненного цикла и связанных событий сотрудников служб. 

1. Зарегистрируйте сотрудника службы.  
1.  Браузер загружает файл JavaScript, устанавливает сотрудника службы и инициирует `install` событие. Вы можете использовать `install` событие для предварительного кэширования важных и длительных файлов, таких как CSS-файлы, файлы JavaScript, изображения логотипов, автономные страницы и т. д.  
    
    ```javascript
    self.addEventListener( "install", function( event ){
        console.log( "WORKER: install event in progress." );
    });
    ```  
    
1.  Активируется сотрудник службы, который запускает `activate` событие.  Это событие используется для очистки устаревших кэшей.  
    
    ```javascript
    self.addEventListener( "activate", event => {
        console.log('WORKER: activate event in progress.');
    });
    ```  
    
1.  Сотрудник службы готов к выполнению при обновлении страницы или при переходе пользователя на новую страницу сайта. Если вы хотите запустить сервисный сотрудник без ожидания, используйте `self.skipWaiting()` метод во время `install` события.  
    
    ```javascript
    self.addEventListener( "install", event => {
        self.skipWaiting();
        // …
    });
    ```
    
1.  Рабочий процесс обслуживания сейчас выполняется.     
    
## Использование fetch в рабочих работниках служб  

Основное событие, используемое в качестве сотрудника службы, — это `fetch` событие.  `fetch`Событие выполняется каждый раз, когда браузер пытается получить доступ к содержимому в области действия сотрудника службы. В следующем фрагменте кода показано, как добавить прослушиватель в событие FETCH.  

```javascript
self.addEventListener( "fetch", event => {
  console.log('WORKER: Fetching', event.request);
});
```  

Внутри `fetch` обработчика вы можете указать, будет ли запрос переноситься в сеть, отвлекать из кэша и т. д.  Подход, который вы будете использовать, зависит от типа запрашиваемого ресурса, частоты его обновления и других бизнес-логики, уникальных для вашего приложения.  Вот несколько примеров того, что можно сделать:  

*   Если это возможно, возвращайте ответ из кэша, в противном случае — откат, чтобы запросить ресурс по сети.  
*   Получение ресурса из сети, кэширование копии и возврат ответа.
*   Разрешить пользователю указывать параметр, позволяющий сохранить данные. 
*   Укажите изображение заполнителя для определенных запросов изображений.  
*   Создание ответа непосредственно в сотруднике службы.  

## Push-уведомления  

Работники обслуживания могут отправлять уведомления пользователям. Push-уведомления полезны для запроса пользователей на повторное взаимодействие с приложением после того, как прошло какое-то время. Дополнительные сведения можно найти в разделе [Пошаговые инструкции и демонстрация push-уведомлений][AzurewebsitesWebpushdemo].  

## См. также  

Дополнительные сведения о сотрудниках служб можно найти в приведенном ниже списке соответствующих тем.  

*   [PWAs автономной работы с сотрудниками служб][MDNPwasMakingOfflineServiceWorkers]  
*   [Как сделать так, чтобы PWAs повторно привлекать с помощью уведомлений и Push][MDNPwasMakeReengageablesingNotificationsPush]  

<!-- links -->  

[AzurewebsitesWebpushdemo]: https://webpushdemo.azurewebsites.net "Push-уведомления в Интернете |  Демонстрации Microsoft Edge"  

[MDNPwasMakingOfflineServiceWorkers]: https://developer.mozilla.org/docs/Web/Progressive_web_apps/Offline_Service_workers "Как сделать PWAs работать автономно с сотрудниками служб — PWAs | MDN"  
[MDNPwasMakeReengageablesingNotificationsPush]: https://developer.mozilla.org/docs/Web/Progressive_web_apps/Re-engageable_Notifications_Push "Как сделать так, чтобы PWAs повторной подписаться с помощью уведомлений и Push-PWAs | MDN"  
